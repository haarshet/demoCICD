public class BoxAuthService_cntllr {
    
    public string body{set;get;}
    public superItemList[] datalist {get;set;}
    
    public PageReference redirectUser(){
        system.debug('inside');
        return new PageReference('https://account.box.com/api/oauth2/authorize/?client_id=a59c3jad663n1kv05xqlq3b2hnuddx3l&response_type=code');
        
    }
    
    public void getAccessToken(){
        String authcode = apexpages.currentpage().getParameters().get('Code');
        system.debug('authcode'+authcode);
        // framing request to get access token with the code 
        // instantiate http class
        Http http = new HTTP();
        //frame the request
        
        Httprequest req = new Httprequest();
        req.setEndPoint('https://api.box.com/oauth2/token');
        req.setmethod('GET'); 
        req.setHeader('Accept','application/json');
        req.setBody('grant_type=authorization_code&code='+authcode+'&client_id=a59c3jad663n1kv05xqlq3b2hnuddx3l&client_secret=c2gFLr5gdKf0hqrxGPNYMvkAC4xSZw7l');
        // step3: send the response and handle the response
        HttpResponse response = http.send(req);
        
        
        fromJSON d=(fromJSON)JSON.deserialize(response.getbody(),fromJSON.class);
        
        body= getFolders(d.access_token);
        
        ParseFolderContent p=(ParseFolderContent)JSON.deserialize(body,ParseFolderContent.class);
        
        datalist = new SuperItemList[] {};
            
            for (Integer i=0; i<p.entries.size(); i++){
                dataList.add(new SuperItemList(p.entries[i].id,p.entries[i].type,p.entries[i].name));
            }
        
        
        
        
        
    }
    
    public String getFolders(String access_token) {
        Http http = new Http();
        Httprequest req = new Httprequest();
        req.setEndPoint('https://api.box.com/2.0/folders/279885973565/items');
        req.setmethod('GET'); 
        req.setHeader('Accept','application/json');
        req.setHeader('Authorization', 'Bearer '+ access_token);
        // step3: send the response and handle the response
        HttpResponse res = http.send(req);
        
        return res.getbody();
        
    }
    
    
    public class superItemList{
        public string id_x{set;get;}
        public string type_x{set;get;}
        public string name_x{set;get;}
        
        
        public superItemList(string id_x,string type_x,string name_x){
            this.id_x = id_x;
            this.type_x = type_x;
            this.name_x = name_x;
            
            
            
        }
        
    }
        
        //
        //Generated by AdminBooster
        //
        
        public class fromJSON{
            public String access_token;	//pPOqznepHoSPyYhACEJFsrovXYhuOPTI
            public Integer expires_in;	//3617
            public cls_restricted_to[] restricted_to;
            public String refresh_token;	//DFwb3O5etW4rOAGA8T3WDsxmqyagXQ2wZQB2SsOojhDmtsPQwU8EKbhcjDlPuI12
            public String token_type;	//bearer
            
            
        }
        
        class cls_restricted_to {
        }
        
        //
        //Generated by AdminBooster
        //
        
        public class ParseFolderContent{
            public Integer total_count;	//1
            public cls_entries[] entries;
            public Integer offset;	//0
            public Integer limit_x;	//100
            public cls_order[] order;
            
        }
        
        class cls_entries {
            public String type;	//file
            public String id;	//1619692588324
            public cls_file_version file_version;
            public String sequence_id;	//0
            public String etag;	//0
            public String sha1;	//5585747ce3af2c93811fbdbd3410c5b6c2f9d0dc
            public String name;	//New Adhar card (1).pdf
        }
        class cls_file_version {
            public String type;	//file_version
            public String id;	//1780738213924
            public String sha1;	//5585747ce3af2c93811fbdbd3410c5b6c2f9d0dc
        }
        class cls_order {
            public String by_x;	//type
            public String direction;	//ASC
        }
        
        
        
}